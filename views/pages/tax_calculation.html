<!DOCTYPE html>
<html>
<head>
	<title>Tax Calculation</title>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>
<body>
	<div class="container">
		<div style="height: 100px"></div>
		<label>Marital Status: </label>
		<br>
		<input type="radio" name="marital_status" value="single" checked> Single / Separated / Divorced / Widowed<br>
		<input type="radio" name="marital_status" value="married"> Married<br>

		<br><br>
		<form id="input-form">
			<label>Personal Income (Annual): $</label>
			<input id="personal-income" type="number"  min="0" name="personal-income" oninput="validity.valid||(value='');">
			<div id="income-alert" style="display: none; color: red;">* Income cannot be empty!</div>
			<br>
			<label>MPF Contribution: $</label>
			<input id="mpf-contribution" type="number" name="mpf-contribution" disabled>
			<br>
			<label>Personal Allowance: $</label>
			<input id="personal-allowance" type="number" name="personal-allowance" value="132000" disabled>
		</form>



		<br><br>
		<button class="btn btn-primary" id="enter-btn" onclick="calculate()" data-toggle="tooltip" title="Calculate the input">Enter</button>
		<button class="btn btn-secondary" onclick="resetAll()" data-toggle="tooltip" title="Clear input data">Reset All</button>

		<hr>
		<h3>Result</h3>
		<label>Tax: $</label>
		<span id="final-tax"><strong> 0.00 </strong></span>

		<br><br>
		<div class="table-responsive">
			<table class="table table-hover table-bordered">
				<tbody>
					<tr class="table-primary">
						<th scope="col">&nbsp;</th>
						<th scope="col">Net chargeable Income</th>
						<th scope="col">Rate</th>
						<th scope="col">Tax</th>
					</tr>
					<tr>
						<th style="width: 25%;">&nbsp;</th>
						<th style="text-align: center; width: 25%;">
							<p>$</p>
						</th>
						<th style="text-align: center; width: 25%;">&nbsp;</th>
						<th style="text-align: center; width: 25%;">
							<p>$</p>
						</th>
					</tr>
					<tr>
						<td scope="row">On the First</td>
						<td style="text-align: right; width: 25%;">50,000</td>
						<td style="text-align: right; width: 25%;" id="first">2%</td>
						<td style="text-align: right; width: 25%;">1,000</td>
					</tr>
					<tr>
						<td scope="row">On the Next</td>
						<td style="text-align: right; width: 25%;"><span style="text-decoration: underline;">50,000</span></td>
						<td style="text-align: right; width: 25%;" id="second">6%</td>
						<td style="text-align: right; width: 25%;"><span style="text-decoration: underline;">3,000</span></td>
					</tr>
					<tr>
						<td scope="row">&nbsp;</td>
						<td style="text-align: right; width: 25%;">100,000</td>
						<td style="text-align: right; width: 25%;">&nbsp;</td>
						<td style="text-align: right; width: 25%;">4,000</td>
					</tr>
					<tr>
						<td scope="row">On the Next</td>
						<td style="text-align: right; width: 25%;"><span style="text-decoration: underline;">50,000</span></td>
						<td style="text-align: right; width: 25%;" id="third">10%</td>
						<td style="text-align: right; width: 25%;"><span style="text-decoration: underline;">5,000</span></td>
					</tr>
					<tr>
						<td scope="row">&nbsp;</td>
						<td style="text-align: right; width: 25%;">150,000</td>
						<td style="text-align: right; width: 25%;">&nbsp;</td>
						<td style="text-align: right; width: 25%;">9,000</td>
					</tr>
					<tr>
						<td stscope="row">On the Next</td>
						<td style="text-align: right; width: 25%;"><span style="text-decoration: underline;">50,000</span></td>
						<td style="text-align: right; width: 25%;" id="fourth">14%</td>
						<td style="text-align: right; width: 25%;"><span style="text-decoration: underline;">7,000</span></td>
					</tr>
					<tr>
						<td scope="row">&nbsp;</td>
						<td style="text-align: right; width: 25%;">200,000</td>
						<td style="text-align: right; width: 25%;">&nbsp;</td>
						<td style="text-align: right; width: 25%;">16,000</td>
					</tr>
					<tr>
						<td scope="row">Remainder</td>
						<td style="text-align: right; width: 25%;">&nbsp;</td>
						<td style="text-align: right; width: 25%;" id="remaining">17%</td>
						<td style="text-align: right; width: 25%;">&nbsp;</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<div style="height: 100px"></div>
</body>
</html>
<style>
	#tax td {
		padding: 5px;
	}
</style>
<script type="text/javascript">

	var radios = document.querySelectorAll('input[type=radio][name="marital_status"]');

	function changeHandler(event) {
	    if (this.value == 'single') {
			document.getElementById("personal-allowance").value = 132000;
	   	} else if (this.value == 'married') {
			document.getElementById("personal-allowance").value = 264000;
	   	}
	}


	Array.prototype.forEach.call(radios, function(radio) {
	   radio.addEventListener('change', changeHandler);
	});


	function calculate() {
		var personal_income = document.getElementById('personal-income').value;

		if (personal_income == ''){
			// Hide the income error msg
			$('#income-alert').css('display', 'block');
		} else{
			$('#income-alert').css('display', 'none');

			var personal_allowance = document.getElementById("personal-allowance").value;

			document.getElementById("mpf-contribution").value = calculateMPF(personal_income).toFixed(2);

			var net_chargeable_income = personal_income - calculateMPF(personal_income) - personal_allowance;

			document.getElementById("final-tax").innerHTML = calculateTax(net_chargeable_income).toFixed(2);

			// calculateTax(personal_income)
		}
	}

	function calculateMPF(personal_income) {
		var monthly_income = personal_income / 12;
		if (monthly_income < 7100) {

			return 0 * 12
		} else if (monthly_income <= 30000) {

			return monthly_income * 0.05 * 12
		}
		else {
			return 1500 * 12
		}
	}

	function calculateTax(net_chargeable_income) {
		// console.log(net_chargeable_income);

		var tax = 0;
	// 	var remaining_income = net_chargeable_income;
	// 	var income_per_count = 50000;
	// 	var tax_rate = 0.02;

	// 	// count how many round is needed
	// 	var cal_count = remaining_income / 50000;
	// 	console.log(cal_count);

	// 	for (var i = 1; i <= cal_count; i++) {
	// 	  	tax += income_per_count * tax_rate;
	// 	  	tax_rate += 0.04;
	// 	  	remaining_income -= income_per_count;
	// 	  	console.log(tax);
	// 	}
	// 	tax += remaining_income * 0.17;
	// 	return tax;
	// }
		var first = document.getElementById('first').innerText;
		// console.log(test);
		// console.log(first.length)
		if (first.length <= 2) {
			first = first.charAt(0)
			console.log(first)
		} else {
			first = first.substring(0, first.length - 2);
			// console.log(first)
		}
		first = first / 100;
		console.log(first);

		if (net_chargeable_income <= 50000) {
			tax = net_chargeable_income * first;
		}
		else if (net_chargeable_income <= 100000)
	};

	// Clean input fields data
	function resetAll() {
		document.getElementById("input-form").reset();
		$("#final-tax").html("<strong> 0.00 </strong>");
	}

	// Press enter will calculate
	var input = document.getElementsByTagName("BODY")[0];

	input.addEventListener("keyup", function(event) {
	  // Number 13 is the "Enter" key on the keyboard
	  if (event.keyCode === 13) {
	    // Cancel the default action, if needed
	    event.preventDefault();
	    // Trigger the button element with a click
	    document.getElementById("enter-btn").click();
	}

	// Enable tooltips everywhere
	$(function () {
		$('[data-toggle="tooltip"]').tooltip()
	})
});
</script>
